<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-07-19 Tue 19:47 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>The Elm Architecture в Android проекте: 3 года спустя</title>
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
</style>
<style>/*! normalize.css v4.1.1 | MIT License | github.com/necolas/normalize.css */
html {
  font-family: sans-serif;
  line-height: 1.15;
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
}
body {
  margin: 0;
}
article,
aside,
details,
figcaption,
figure,
footer,
header,
main,
menu,
nav,
section,
summary {
  display: block;
}
audio,
canvas,
progress,
video {
  display: inline-block;
}
audio:not([controls]) {
  display: none;
  height: 0;
}
progress {
  vertical-align: baseline;
}
[hidden],
template {
  display: none;
}
a {
  background-color: transparent;
  -webkit-text-decoration-skip: objects;
}
a:active,
a:hover {
  outline-width: 0;
}
abbr[title] {
  border-bottom: none;
  text-decoration: underline;
  -webkit-text-decoration: underline dotted;
  text-decoration: underline dotted;
}
b,
strong {
  font-weight: inherit;
  font-weight: bolder;
}
dfn {
  font-style: italic;
}
h1 {
  font-size: 2em;
  margin: 0.67em 0;
}
mark {
  background-color: #ff0;
  color: #000;
}
small {
  font-size: 80%;
}
sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
sub {
  bottom: -0.25em;
}
sup {
  top: -0.5em;
}
img {
  border-style: none;
}
svg:not(:root) {
  overflow: hidden;
}
code,
kbd,
pre,
samp {
  font-family: monospace, monospace;
  font-size: 1em;
}
figure {
  margin: 1em 40px;
}
hr {
  box-sizing: content-box;
  height: 0;
  overflow: visible;
}
button,
input,
optgroup,
select,
textarea {
  font: inherit;
  margin: 0;
}
optgroup {
  font-weight: 700;
}
button,
input {
  overflow: visible;
}
button,
select {
  text-transform: none;
}
[type="reset"],
[type="submit"],
button,
html [type="button"] {
  -webkit-appearance: button;
}
[type="button"]::-moz-focus-inner,
[type="reset"]::-moz-focus-inner,
[type="submit"]::-moz-focus-inner,
button::-moz-focus-inner {
  border-style: none;
  padding: 0;
}
[type="button"]:-moz-focusring,
[type="reset"]:-moz-focusring,
[type="submit"]:-moz-focusring,
button:-moz-focusring {
  outline: 1px dotted ButtonText;
}
fieldset {
  border: 1px solid silver;
  margin: 0 2px;
  padding: 0.35em 0.625em 0.75em;
}
legend {
  box-sizing: border-box;
  color: inherit;
  display: table;
  max-width: 100%;
  padding: 0;
  white-space: normal;
}
textarea {
  overflow: auto;
}
[type="checkbox"],
[type="radio"] {
  box-sizing: border-box;
  padding: 0;
}
[type="number"]::-webkit-inner-spin-button,
[type="number"]::-webkit-outer-spin-button {
  height: auto;
}
[type="search"] {
  -webkit-appearance: textfield;
  outline-offset: -2px;
}
[type="search"]::-webkit-search-cancel-button,
[type="search"]::-webkit-search-decoration {
  -webkit-appearance: none;
}
::-webkit-input-placeholder {
  color: inherit;
  opacity: 0.54;
}
::-webkit-file-upload-button {
  -webkit-appearance: button;
  font: inherit;
}
body {
  color: #000;
  background-color: #fff;
}
.org-alert-high {
  color: #ff8c00;
  font-weight: 700;
}
.org-alert-low {
  color: #00008b;
}
.org-alert-moderate {
  color: gold;
  font-weight: 700;
}
.org-alert-saved-fringe {
  background-color: #f2f2f2;
}
.org-alert-trivial {
  color: Dark purple;
}
.org-alert-urgent {
  color: red;
  font-weight: 700;
}
.org-anzu-match-1 {
  color: #000;
  background-color: #7fffd4;
}
.org-anzu-match-2 {
  color: #000;
  background-color: #00ff7f;
}
.org-anzu-match-3 {
  color: #000;
  background-color: #ff0;
}
.org-anzu-mode-line,
.org-anzu-mode-line-no-match {
  color: #008b00;
  font-weight: 700;
}
.org-anzu-replace-highlight {
  color: #b0e2ff;
  background-color: #cd00cd;
}
.org-anzu-replace-to {
  color: red;
}
.org-bbdb-field-name {
  color: sienna;
}
.org-bbdb-name {
  color: #00f;
}
.org-bbdb-organization {
  color: #b22222;
}
.org-beacon-fallback-background {
  background-color: #000;
}
.org-biblio-results-header {
  color: #483d8b;
  font-size: 150%;
  font-weight: 700;
}
.org-bold {
  font-weight: 700;
}
.org-bold-italic {
  font-weight: 700;
  font-style: italic;
}
.org-bookmark-menu-bookmark {
  font-weight: 700;
}
.org-bookmark-menu-heading {
  color: #228b22;
}
.org-buffer-menu-buffer {
  font-weight: 700;
}
.org-builtin {
  color: #483d8b;
}
.org-button {
  color: #3a5fcd;
  text-decoration: underline;
}
.org-c-annotation {
  color: #008b8b;
}
.org-cal-china-x-general-holiday {
  background-color: #228b22;
}
.org-cal-china-x-important-holiday {
  background-color: #8b0000;
}
.org-calendar-iso-week {
  color: pink;
  font-weight: 700;
}
.org-calendar-iso-week-header {
  color: #0ff;
}
.org-calendar-month-header {
  color: #00f;
}
.org-calendar-today {
  text-decoration: underline;
}
.org-calendar-weekday-header {
  color: #008b8b;
}
.org-calendar-weekend-header {
  color: #b22222;
}
.org-comint-highlight-input {
  font-weight: 700;
}
.org-comint-highlight-prompt {
  color: #0000cd;
}
.org-comment,
.org-comment-delimiter {
  color: #b22222;
}
.org-compilation-column-number {
  color: #8b2252;
}
.org-compilation-error {
  color: red;
  font-weight: 700;
}
.org-compilation-info {
  color: #228b22;
  font-weight: 700;
}
.org-compilation-line-number {
  color: #a020f0;
}
.org-compilation-mode-line-exit {
  color: #228b22;
  font-weight: 700;
}
.org-compilation-mode-line-fail {
  color: red;
  font-weight: 700;
}
.org-compilation-mode-line-run,
.org-compilation-warning {
  color: #ff8c00;
  font-weight: 700;
}
.org-completions-annotations {
  font-style: italic;
}
.org-completions-first-difference {
  font-weight: 700;
}
.org-constant {
  color: #008b8b;
}
.org-cursor {
  background-color: #eead0e;
}
.org-custom-button {
  color: #000;
  background-color: #d3d3d3;
}
.org-custom-button-mouse {
  color: #000;
  background-color: #e5e5e5;
}
.org-custom-button-pressed {
  color: #000;
  background-color: #d3d3d3;
}
.org-custom-button-pressed-unraised {
  color: #8b008b;
  text-decoration: underline;
}
.org-custom-button-unraised {
  text-decoration: underline;
}
.org-custom-changed {
  color: #fff;
  background-color: #00f;
}
.org-custom-comment {
  background-color: #d9d9d9;
}
.org-custom-comment-tag {
  color: #00008b;
}
.org-custom-face-tag {
  color: #00f;
  font-weight: 700;
}
.org-custom-group-subtitle {
  font-weight: 700;
}
.org-custom-group-tag {
  color: #00f;
  font-size: 120%;
  font-weight: 700;
}
.org-custom-group-tag-1 {
  color: red;
  font-size: 120%;
  font-weight: 700;
}
.org-custom-invalid {
  color: #ff0;
  background-color: red;
}
.org-custom-link {
  color: #3a5fcd;
  text-decoration: underline;
}
.org-custom-modified {
  color: #fff;
  background-color: #00f;
}
.org-custom-rogue {
  color: pink;
  background-color: #000;
}
.org-custom-saved {
  text-decoration: underline;
}
.org-custom-set {
  color: #00f;
  background-color: #fff;
}
.org-custom-state {
  color: #006400;
}
.org-custom-themed {
  color: #fff;
  background-color: #00f;
}
.org-custom-variable-button {
  font-weight: 700;
  text-decoration: underline;
}
.org-custom-variable-tag {
  color: #00f;
  font-weight: 700;
}
.org-custom-visibility {
  color: #3a5fcd;
  font-size: 80%;
  text-decoration: underline;
}
.org-diary {
  color: red;
}
.org-diary-anniversary {
  color: #a020f0;
}
.org-diary-time {
  color: sienna;
}
.org-dired-async-failures {
  color: red;
}
.org-dired-async-message {
  color: #ff0;
}
.org-dired-async-mode-message {
  color: gold;
}
.org-dired-directory {
  color: #00f;
}
.org-dired-flagged {
  color: red;
  font-weight: 700;
}
.org-dired-header {
  color: #228b22;
}
.org-dired-ignored {
  color: #7f7f7f;
}
.org-dired-mark {
  color: #008b8b;
}
.org-dired-marked {
  color: #ff8c00;
  font-weight: 700;
}
.org-dired-perm-write {
  color: #b22222;
}
.org-dired-symlink {
  color: #a020f0;
}
.org-dired-warning {
  color: red;
  font-weight: 700;
}
.org-doc {
  color: #8b2252;
}
.org-eldoc-highlight-function-argument {
  font-weight: 700;
}
.org-epa-field-body {
  font-style: italic;
}
.org-epa-field-name,
.org-epa-mark {
  font-weight: 700;
}
.org-epa-mark {
  color: red;
}
.org-epa-string {
  color: #00008b;
}
.org-epa-validity-disabled {
  font-style: italic;
}
.org-epa-validity-high {
  font-weight: 700;
}
.org-epa-validity-low,
.org-epa-validity-medium {
  font-style: italic;
}
.org-error {
  color: red;
  font-weight: 700;
}
.org-escape-glyph {
  color: brown;
}
.org-evil-ex-commands {
  font-style: italic;
  text-decoration: underline;
}
.org-evil-ex-info {
  color: red;
  font-style: italic;
}
.org-evil-ex-lazy-highlight {
  background-color: #afeeee;
}
.org-evil-ex-search {
  color: #b0e2ff;
  background-color: #cd00cd;
}
.org-evil-ex-substitute-matches {
  background-color: #afeeee;
}
.org-evil-ex-substitute-replacement {
  color: red;
  text-decoration: underline;
}
.org-ffap {
  background-color: #b4eeb4;
}
.org-file-name-shadow {
  color: #7f7f7f;
}
.org-flycheck-error {
  text-decoration: underline;
}
.org-flycheck-error-list-checker-name {
  color: #00f;
}
.org-flycheck-error-list-column-number {
  color: #008b8b;
}
.org-flycheck-error-list-error {
  color: red;
  font-weight: 700;
}
.org-flycheck-error-list-filename {
  color: sienna;
}
.org-flycheck-error-list-highlight {
  background-color: #b4eeb4;
}
.org-flycheck-error-list-id,
.org-flycheck-error-list-id-with-explainer {
  color: #228b22;
}
.org-flycheck-error-list-info {
  color: #228b22;
  font-weight: 700;
}
.org-flycheck-error-list-line-number {
  color: #008b8b;
}
.org-flycheck-error-list-warning {
  color: #ff8c00;
  font-weight: 700;
}
.org-flycheck-fringe-error {
  color: red;
  font-weight: 700;
}
.org-flycheck-fringe-info {
  color: #228b22;
  font-weight: 700;
}
.org-flycheck-fringe-warning {
  color: #ff8c00;
  font-weight: 700;
}
.org-flycheck-info,
.org-flycheck-warning,
.org-flyspell-duplicate,
.org-flyspell-incorrect {
  text-decoration: underline;
}
.org-fringe {
  background-color: #f2f2f2;
}
.org-function-name {
  color: #00f;
}
.org-glyphless-char {
  font-size: 60%;
}
.org-golden-ratio-scroll-highlight-line {
  color: #fff;
  background-color: #53868b;
  font-weight: 700;
}
.org-header-line {
  color: #333;
  background-color: #e5e5e5;
}
.org-helm-action {
  text-decoration: underline;
}
.org-helm-bookmark-addressbook {
  color: tomato;
}
.org-helm-bookmark-directory {
  color: #8b0000;
  background-color: #d3d3d3;
}
.org-helm-bookmark-file {
  color: #00b2ee;
}
.org-helm-bookmark-file-not-found {
  color: #6c7b8b;
}
.org-helm-bookmark-gnus {
  color: #f0f;
}
.org-helm-bookmark-info {
  color: #0f0;
}
.org-helm-bookmark-man {
  color: #8b5a00;
}
.org-helm-bookmark-w3m {
  color: #ff0;
}
.org-helm-buffer-archive {
  color: gold;
}
.org-helm-buffer-directory {
  color: #8b0000;
  background-color: #d3d3d3;
}
.org-helm-buffer-file {
  color: #483d8b;
}
.org-helm-buffer-modified {
  color: #b22222;
}
.org-helm-buffer-not-saved {
  color: #ee6363;
}
.org-helm-buffer-process {
  color: #cd6839;
}
.org-helm-buffer-saved-out {
  color: red;
  background-color: #000;
}
.org-helm-buffer-size {
  color: #708090;
}
.org-helm-candidate-number,
.org-helm-candidate-number-suspended {
  color: #000;
  background-color: #faffb5;
}
.org-helm-delete-async-message {
  color: #ff0;
}
.org-helm-etags-file {
  color: #8b814c;
  text-decoration: underline;
}
.org-helm-ff-denied {
  color: red;
  background-color: #000;
}
.org-helm-ff-directory {
  color: #8b0000;
  background-color: #d3d3d3;
}
.org-helm-ff-dirs {
  color: #00f;
}
.org-helm-ff-dotted-directory {
  color: #000;
  background-color: #696969;
}
.org-helm-ff-dotted-symlink-directory {
  color: #ff8c00;
  background-color: #696969;
}
.org-helm-ff-executable {
  color: #0f0;
}
.org-helm-ff-file {
  color: #483d8b;
}
.org-helm-ff-invalid-symlink {
  color: #000;
  background-color: red;
}
.org-helm-ff-pipe {
  color: #ff0;
  background-color: #000;
}
.org-helm-ff-prefix {
  color: #000;
  background-color: #ff0;
}
.org-helm-ff-socket {
  color: #ff1493;
}
.org-helm-ff-suid {
  color: #fff;
  background-color: red;
}
.org-helm-ff-symlink {
  color: #b22222;
}
.org-helm-ff-truename {
  color: #8b2252;
}
.org-helm-grep-cmd-line {
  color: #228b22;
}
.org-helm-grep-file {
  color: #8a2be2;
  text-decoration: underline;
}
.org-helm-grep-finish {
  color: #0f0;
}
.org-helm-grep-lineno {
  color: #ff7f00;
}
.org-helm-grep-match {
  color: #b00000;
}
.org-helm-header {
  color: #333;
  background-color: #e5e5e5;
}
.org-helm-header-line-left-margin {
  color: #000;
  background-color: #ff0;
}
.org-helm-helper {
  color: #333;
  background-color: #e5e5e5;
}
.org-helm-history-deleted {
  color: #000;
  background-color: red;
}
.org-helm-history-remote {
  color: #ff6a6a;
}
.org-helm-lisp-completion-info {
  color: red;
}
.org-helm-lisp-show-completion {
  background-color: #2f4f4f;
}
.org-helm-locate-finish {
  color: #0f0;
}
.org-helm-m-x-key {
  color: orange;
  text-decoration: underline;
}
.org-helm-match {
  color: #b00000;
}
.org-helm-match-item {
  color: #b0e2ff;
  background-color: #cd00cd;
}
.org-helm-minibuffer-prompt {
  color: #0000cd;
}
.org-helm-moccur-buffer {
  color: #00ced1;
  text-decoration: underline;
}
.org-helm-non-file-buffer {
  font-style: italic;
}
.org-helm-prefarg {
  color: red;
}
.org-helm-resume-need-update {
  background-color: red;
}
.org-helm-selection {
  background-color: #097209;
}
.org-helm-selection-line {
  background-color: #b4eeb4;
}
.org-helm-separator {
  color: #ffbfb5;
}
.org-helm-source-header {
  color: #000;
  background-color: #abd7f0;
  font-size: 130%;
  font-weight: 700;
}
.org-helm-visible-mark {
  background-color: #d1f5ea;
}
.org-help-argument-name {
  font-style: italic;
}
.org-highlight {
  background-color: #b4eeb4;
}
.org-highlight-indent-guides-character {
  color: #e6e6e6;
}
.org-highlight-indent-guides-even {
  background-color: #e6e6e6;
}
.org-highlight-indent-guides-odd {
  background-color: #f3f3f3;
}
.org-highlight-indent-guides-stack-character {
  color: #ccc;
}
.org-highlight-indent-guides-stack-even {
  background-color: #ccc;
}
.org-highlight-indent-guides-stack-odd {
  background-color: #d9d9d9;
}
.org-highlight-indent-guides-top-character {
  color: #b3b3b3;
}
.org-highlight-indent-guides-top-even {
  background-color: #b3b3b3;
}
.org-highlight-indent-guides-top-odd {
  background-color: silver;
}
.org-highlight-numbers-number {
  color: #008b8b;
}
.org-hl-line {
  background-color: #b4eeb4;
}
.org-holiday {
  background-color: pink;
}
.org-hydra-face-amaranth {
  color: #e52b50;
  font-weight: 700;
}
.org-hydra-face-blue {
  color: #00f;
  font-weight: 700;
}
.org-hydra-face-pink {
  color: #ff6eb4;
  font-weight: 700;
}
.org-hydra-face-red {
  color: red;
  font-weight: 700;
}
.org-hydra-face-teal {
  color: #367588;
  font-weight: 700;
}
.org-ido-first-match {
  font-weight: 700;
}
.org-ido-incomplete-regexp {
  color: red;
  font-weight: 700;
}
.org-ido-indicator {
  color: #ff0;
  background-color: red;
}
.org-ido-only-match {
  color: #228b22;
}
.org-ido-subdir {
  color: red;
}
.org-ido-virtual {
  color: #483d8b;
}
.org-info-header-node {
  color: brown;
  font-weight: 700;
  font-style: italic;
}
.org-info-header-xref {
  color: #3a5fcd;
  text-decoration: underline;
}
.org-info-index-match {
  background-color: #ff0;
}
.org-info-menu-header {
  font-weight: 700;
}
.org-info-menu-star {
  color: red;
}
.org-info-node {
  color: brown;
  font-weight: 700;
  font-style: italic;
}
.org-info-title-1 {
  font-size: 172%;
  font-weight: 700;
}
.org-info-title-2 {
  font-size: 144%;
  font-weight: 700;
}
.org-info-title-3 {
  font-size: 120%;
  font-weight: 700;
}
.org-info-title-4 {
  font-weight: 700;
}
.org-info-xref {
  color: #3a5fcd;
  text-decoration: underline;
}
.org-isearch {
  color: #b0e2ff;
  background-color: #cd00cd;
}
.org-isearch-fail {
  background-color: #ffc1c1;
}
.org-italic {
  font-style: italic;
}
.org-keyword {
  color: #a020f0;
}
.org-lazy-highlight {
  background-color: #afeeee;
}
.org-link {
  color: #3a5fcd;
  text-decoration: underline;
}
.org-link-visited {
  color: #8b008b;
  text-decoration: underline;
}
.org-lv-separator {
  background-color: #ccc;
}
.org-match {
  background-color: #ff0;
}
.org-mcXcursor-bar {
  background-color: #000;
}
.org-mcXregion {
  background-color: gtk_selection_bg_color;
}
.org-me-dired-dim-0 {
  color: #b3b3b3;
}
.org-me-dired-dim-1 {
  color: #7f7f7f;
}
.org-me-dired-executable {
  color: #0f0;
}
.org-message-cited-text {
  color: red;
}
.org-message-header-cc {
  color: #191970;
}
.org-message-header-name {
  color: #6495ed;
}
.org-message-header-newsgroups {
  color: #00008b;
  font-weight: 700;
  font-style: italic;
}
.org-message-header-other {
  color: #4682b4;
}
.org-message-header-subject {
  color: navy;
  font-weight: 700;
}
.org-message-header-to {
  color: #191970;
  font-weight: 700;
}
.org-message-header-xheader {
  color: #00f;
}
.org-message-mml {
  color: #228b22;
}
.org-message-separator {
  color: brown;
}
.org-minibuffer-prompt {
  color: #0000cd;
}
.org-mm-command-output {
  color: #cd0000;
}
.org-mode-line {
  color: #000;
  background-color: #bfbfbf;
}
.org-mode-line-buffer-id,
.org-mode-line-buffer-id-inactive,
.org-mode-line-emphasis {
  font-weight: 700;
}
.org-mode-line-inactive {
  color: #333;
  background-color: #e5e5e5;
}
.org-mu4e-attach-number {
  color: sienna;
  font-weight: 700;
}
.org-mu4e-cited-1 {
  color: #483d8b;
  font-style: italic;
}
.org-mu4e-cited-2 {
  color: #5cacee;
  font-style: italic;
}
.org-mu4e-cited-3 {
  color: sienna;
  font-style: italic;
}
.org-mu4e-cited-4 {
  color: #a020f0;
  font-style: italic;
}
.org-mu4e-cited-5,
.org-mu4e-cited-6 {
  color: #b22222;
  font-style: italic;
}
.org-mu4e-cited-7 {
  color: #228b22;
  font-style: italic;
}
.org-mu4e-compose-header,
.org-mu4e-compose-separator {
  color: brown;
  font-style: italic;
}
.org-mu4e-contact {
  color: sienna;
}
.org-mu4e-context {
  color: #006400;
  font-weight: 700;
}
.org-mu4e-draft {
  color: #8b2252;
}
.org-mu4e-flagged {
  color: #008b8b;
  font-weight: 700;
}
.org-mu4e-footer {
  color: #b22222;
}
.org-mu4e-forwarded {
  color: #483d8b;
}
.org-mu4e-header {
  color: #000;
  background-color: #fff;
}
.org-mu4e-header-highlight {
  background-color: #000;
  font-weight: 700;
  text-decoration: underline;
}
.org-mu4e-header-key {
  color: #6495ed;
  font-weight: 700;
}
.org-mu4e-header-marks {
  color: #483d8b;
}
.org-mu4e-header-title,
.org-mu4e-header-value {
  color: #228b22;
}
.org-mu4e-highlight {
  background-color: #b4eeb4;
}
.org-mu4e-link {
  color: #3a5fcd;
  text-decoration: underline;
}
.org-mu4e-modeline {
  color: #8b4500;
  font-weight: 700;
}
.org-mu4e-moved {
  color: #b22222;
  font-style: italic;
}
.org-mu4e-ok {
  color: #b22222;
  font-weight: 700;
}
.org-mu4e-region-code {
  background-color: #2f4f4f;
}
.org-mu4e-replied,
.org-mu4e-special-header-value {
  color: #483d8b;
}
.org-mu4e-system {
  color: #b22222;
  font-style: italic;
}
.org-mu4e-title {
  color: #228b22;
  font-weight: 700;
}
.org-mu4e-trashed {
  color: #b22222;
  text-decoration: line-through;
}
.org-mu4e-unread {
  color: #a020f0;
  font-weight: 700;
}
.org-mu4e-url-number {
  color: #008b8b;
  font-weight: 700;
}
.org-mu4e-view-body {
  color: #000;
  background-color: #fff;
}
.org-mu4e-warning {
  color: red;
  font-weight: 700;
}
.org-next-error {
  background-color: gtk_selection_bg_color;
}
.org-nobreak-space {
  color: brown;
  text-decoration: underline;
}
.org-org-agenda-calendar-event,
.org-org-agenda-calendar-sexp {
  color: #000;
  background-color: #fff;
}
.org-org-agenda-clocking {
  background-color: #ff0;
}
.org-org-agenda-column-dateline {
  background-color: #e5e5e5;
}
.org-org-agenda-current-time {
  color: #b8860b;
}
.org-org-agenda-date {
  color: #00f;
}
.org-org-agenda-date-today {
  color: #00f;
  font-weight: 700;
  font-style: italic;
}
.org-org-agenda-date-weekend {
  color: #00f;
  font-weight: 700;
}
.org-org-agenda-diary {
  color: #000;
  background-color: #fff;
}
.org-org-agenda-dimmed-todo {
  color: #7f7f7f;
}
.org-org-agenda-done {
  color: #228b22;
}
.org-org-agenda-filter-category,
.org-org-agenda-filter-effort,
.org-org-agenda-filter-regexp,
.org-org-agenda-filter-tags {
  color: #000;
  background-color: #bfbfbf;
}
.org-org-agenda-restriction-lock {
  background-color: #eee;
}
.org-org-agenda-structure {
  color: #00f;
}
.org-org-archived {
  color: #7f7f7f;
}
.org-org-block {
  color: #7f7f7f;
}
.org-org-block-begin-line,
.org-org-block-end-line {
  color: #b22222;
}
.org-org-checkbox {
  font-weight: 700;
}
.org-org-checkbox-statistics-done {
  color: #228b22;
  font-weight: 700;
}
.org-org-checkbox-statistics-todo {
  color: red;
  font-weight: 700;
}
.org-org-clock-overlay {
  color: #000;
  background-color: #d3d3d3;
}
.org-org-code {
  color: #7f7f7f;
}
.org-org-column,
.org-org-column-title {
  background-color: #e5e5e5;
}
.org-org-column-title {
  font-weight: 700;
  text-decoration: underline;
}
.org-org-date {
  color: #bfaf87;
  text-decoration: underline;
}
.org-org-date-selected {
  color: red;
}
.org-org-default {
  color: #000;
  background-color: #fff;
}
.org-org-document-info {
  color: #191970;
}
.org-org-document-info-keyword {
  color: #7f7f7f;
}
.org-org-document-title {
  color: #191970;
  font-weight: 700;
}
.org-org-done {
  color: #228b22;
  font-weight: 700;
}
.org-org-drawer {
  color: #00f;
}
.org-org-ellipsis {
  color: #b8860b;
  text-decoration: underline;
}
.org-org-footnote {
  color: #96b4cd;
  text-decoration: underline;
}
.org-org-formula {
  color: #b22222;
}
.org-org-habit-alert {
  background-color: #f5f946;
}
.org-org-habit-alert-future {
  background-color: #fafca9;
}
.org-org-habit-clear {
  background-color: #8270f9;
}
.org-org-habit-clear-future {
  background-color: #d6e4fc;
}
.org-org-habit-overdue {
  background-color: #f9372d;
}
.org-org-habit-overdue-future {
  background-color: #fc9590;
}
.org-org-habit-ready {
  background-color: #4df946;
}
.org-org-habit-ready-future {
  background-color: #acfca9;
}
.org-org-headline-done {
  color: #bc8f8f;
}
.org-org-hide {
  color: #fff;
}
.org-org-latex-and-related {
  color: #8b4513;
}
.org-org-level-1 {
  color: #edd1c5;
}
.org-org-level-2 {
  color: #ebebb7;
}
.org-org-level-3 {
  color: #cce8cc;
}
.org-org-level-4 {
  color: #c9deec;
}
.org-org-level-5 {
  color: #dce3e8;
}
.org-org-level-6 {
  color: #dde6dd;
}
.org-org-level-7 {
  color: #e8e8ce;
}
.org-org-level-8 {
  color: #e8dedb;
}
.org-org-link {
  color: #c5d2dc;
  text-decoration: underline;
}
.org-org-list-dt {
  font-weight: 700;
}
.org-org-macro {
  color: #8b4513;
}
.org-org-meta-line {
  color: #b22222;
}
.org-org-mode-line-clock {
  color: #000;
  background-color: #bfbfbf;
}
.org-org-mode-line-clock-overrun {
  color: #000;
  background-color: red;
}
.org-org-priority {
  color: #a020f0;
}
.org-org-quote {
  color: #7f7f7f;
}
.org-org-ref-acronym {
  color: #ee7600;
  text-decoration: underline;
}
.org-org-ref-cite {
  color: #c3d5c3;
  text-decoration: underline;
}
.org-org-ref-glossary {
  color: #8968cd;
  text-decoration: underline;
}
.org-org-ref-label {
  color: #8b008b;
  text-decoration: underline;
}
.org-org-ref-ref {
  color: #e1cc96;
  text-decoration: underline;
}
.org-org-scheduled {
  color: #006400;
}
.org-org-scheduled-previously {
  color: #b22222;
}
.org-org-scheduled-today {
  color: #006400;
}
.org-org-sexp-date {
  color: #a020f0;
}
.org-org-special-keyword {
  color: #88949f;
}
.org-org-table {
  color: #00f;
}
.org-org-tag,
.org-org-tag-group {
  font-weight: 700;
}
.org-org-target {
  text-decoration: underline;
}
.org-org-time-grid {
  color: #b8860b;
}
.org-org-todo {
  color: red;
  font-weight: 700;
}
.org-org-upcoming-deadline {
  color: #b22222;
}
.org-org-verbatim,
.org-org-verse {
  color: #7f7f7f;
}
.org-org-warning {
  color: red;
  font-weight: 700;
}
.org-outline-1 {
  color: #00f;
}
.org-outline-2 {
  color: sienna;
}
.org-outline-3 {
  color: #a020f0;
}
.org-outline-4 {
  color: #b22222;
}
.org-outline-5 {
  color: #228b22;
}
.org-outline-6 {
  color: #008b8b;
}
.org-outline-7 {
  color: #483d8b;
}
.org-outline-8 {
  color: #8b2252;
}
.org-package-description {
  color: #000;
  background-color: #fff;
}
.org-package-name {
  color: #3a5fcd;
  text-decoration: underline;
}
.org-package-status-avail-obso {
  color: #b22222;
}
.org-package-status-available {
  color: #000;
  background-color: #fff;
}
.org-package-status-built-in {
  color: #483d8b;
}
.org-package-status-dependency {
  color: #b22222;
}
.org-package-status-disabled {
  color: red;
  font-weight: 700;
}
.org-package-status-external {
  color: #483d8b;
}
.org-package-status-held {
  color: #008b8b;
}
.org-package-status-incompat,
.org-package-status-installed {
  color: #b22222;
}
.org-package-status-unsigned {
  color: red;
  font-weight: 700;
}
.org-pdf-isearch-batch {
  background-color: #ff0;
}
.org-pdf-isearch-lazy {
  background-color: #afeeee;
}
.org-pdf-isearch-match {
  color: #b0e2ff;
  background-color: #cd00cd;
}
.org-pdf-occur-document {
  color: #8b2252;
}
.org-pdf-occur-page {
  color: #228b22;
}
.org-pdf-view-rectangle {
  background-color: #b4eeb4;
}
.org-pdf-view-region {
  background-color: gtk_selection_bg_color;
}
.org-powerline-active0 {
  color: #000;
  background-color: #bfbfbf;
}
.org-powerline-active1 {
  color: #fff;
  background-color: #2b2b2b;
}
.org-powerline-active2 {
  color: #fff;
  background-color: #666;
}
.org-powerline-inactive0 {
  color: #333;
  background-color: #e5e5e5;
}
.org-powerline-inactive1 {
  color: #333;
  background-color: #1c1c1c;
}
.org-powerline-inactive2 {
  color: #333;
  background-color: #333;
}
.org-preprocessor {
  color: #483d8b;
}
.org-query-replace {
  color: #b0e2ff;
  background-color: #cd00cd;
}
.org-rainbow-delimiters-depth-1 {
  color: #ffdead;
}
.org-rainbow-delimiters-depth-2 {
  color: #00bfff;
}
.org-rainbow-delimiters-depth-3 {
  color: #ffdead;
}
.org-rainbow-delimiters-depth-4 {
  color: #00bfff;
}
.org-rainbow-delimiters-depth-5 {
  color: #ffdead;
}
.org-rainbow-delimiters-depth-6 {
  color: #00bfff;
}
.org-rainbow-delimiters-depth-7 {
  color: #ffdead;
}
.org-rainbow-delimiters-depth-8 {
  color: #00bfff;
}
.org-rainbow-delimiters-depth-9 {
  color: #ffdead;
}
.org-rainbow-delimiters-unmatched {
  color: #88090b;
}
.org-reb-match-0 {
  background-color: #add8e6;
}
.org-reb-match-1 {
  background-color: #7fffd4;
}
.org-reb-match-2 {
  background-color: #00ff7f;
}
.org-reb-match-3 {
  background-color: #ff0;
}
.org-rectangle-preview {
  background-color: gtk_selection_bg_color;
}
.org-regexp-grouping-backslash,
.org-regexp-grouping-construct {
  font-weight: 700;
}
.org-region {
  background-color: gtk_selection_bg_color;
}
.org-secondary-selection {
  background-color: #ff0;
}
.org-semantic-highlight-edits,
.org-semantic-highlight-func-current-tag {
  background-color: #e5e5e5;
}
.org-semantic-unmatched-syntax {
  text-decoration: underline;
}
.org-sgml-namespace {
  color: #483d8b;
}
.org-sh-escaped-newline {
  color: #8b2252;
}
.org-sh-heredoc {
  color: #ee0;
}
.org-sh-quoted-exec {
  color: #f0f;
}
.org-shadow {
  color: #7f7f7f;
}
.org-show-paren-match {
  background-color: #40e0d0;
}
.org-show-paren-mismatch {
  color: #fff;
  background-color: #a020f0;
}
.org-sp-pair-overlay,
.org-sp-show-pair-enclosing {
  background-color: #b4eeb4;
}
.org-sp-show-pair-match {
  background-color: #40e0d0;
}
.org-sp-show-pair-mismatch {
  color: #fff;
  background-color: #a020f0;
}
.org-sp-wrap-overlay {
  background-color: #b4eeb4;
}
.org-sp-wrap-overlay-closing-pair {
  color: red;
  background-color: #b4eeb4;
}
.org-sp-wrap-overlay-opening-pair {
  color: #0f0;
  background-color: #b4eeb4;
}
.org-sp-wrap-tag-overlay {
  background-color: #b4eeb4;
}
.org-spaceline-flycheck-error {
  color: #fc5c94;
  background-color: #333;
}
.org-spaceline-flycheck-info {
  color: #8de6f7;
  background-color: #333;
}
.org-spaceline-flycheck-warning {
  color: #f3ea98;
  background-color: #333;
}
.org-spaceline-python-venv {
  color: #fbf;
}
.org-speedbar-button {
  color: #008b00;
}
.org-speedbar-directory {
  color: #00008b;
}
.org-speedbar-file {
  color: #008b8b;
}
.org-speedbar-highlight {
  background-color: #0f0;
}
.org-speedbar-selected {
  color: red;
  text-decoration: underline;
}
.org-speedbar-separator {
  color: #fff;
  background-color: #00f;
  text-decoration: overline;
}
.org-speedbar-tag {
  color: brown;
}
.org-string {
  color: #8b2252;
}
.org-success {
  color: #228b22;
  font-weight: 700;
}
.org-table-cell {
  color: #e5e5e5;
  background-color: #00f;
}
.org-tex-math {
  color: #8b2252;
}
.org-tool-bar {
  color: #000;
  background-color: #bfbfbf;
}
.org-tooltip {
  color: #000;
  background-color: #ffffe0;
}
.org-trailing-whitespace {
  background-color: red;
}
.org-tty-menu-disabled {
  color: #d3d3d3;
  background-color: #00f;
}
.org-tty-menu-enabled {
  color: #ff0;
  background-color: #00f;
  font-weight: 700;
}
.org-tty-menu-selected {
  background-color: red;
}
.org-type {
  color: #228b22;
}
.org-underline {
  text-decoration: underline;
}
.org-undo-tree-visualizer-active-branch {
  color: #000;
  font-weight: 700;
}
.org-undo-tree-visualizer-current {
  color: red;
}
.org-undo-tree-visualizer-default {
  color: #bebebe;
}
.org-undo-tree-visualizer-register {
  color: #ff0;
}
.org-undo-tree-visualizer-unmodified {
  color: #0ff;
}
.org-variable-name {
  color: sienna;
}
.org-vhlXdefault {
  background-color: #ff0;
}
.org-warning {
  color: #ff8c00;
  font-weight: 700;
}
.org-warning-1 {
  color: red;
  font-weight: 700;
}
.org-wgrep {
  color: #fff;
  background-color: #228b22;
}
.org-wgrep-delete {
  color: pink;
  background-color: #228b22;
}
.org-wgrep-done {
  color: #00f;
}
.org-wgrep-file {
  color: #fff;
  background-color: #228b22;
}
.org-wgrep-reject {
  color: red;
  font-weight: 700;
}
.org-which-key-command-description {
  color: #00f;
}
.org-which-key-docstring {
  color: #b22222;
}
.org-which-key-group-description {
  color: #a020f0;
}
.org-which-key-highlighted-command {
  color: #00f;
  text-decoration: underline;
}
.org-which-key-key {
  color: #008b8b;
}
.org-which-key-local-map-description {
  color: #00f;
}
.org-which-key-note,
.org-which-key-separator {
  color: #b22222;
}
.org-which-key-special-key {
  color: #008b8b;
  font-weight: 700;
}
.org-whitespace-big-indent {
  color: #b22222;
  background-color: red;
}
.org-whitespace-empty {
  color: #b22222;
  background-color: #ff0;
}
.org-whitespace-hspace {
  color: #d3d3d3;
  background-color: #cdc9a5;
}
.org-whitespace-indentation {
  color: #b22222;
  background-color: #ff0;
}
.org-whitespace-line {
  color: violet;
  background-color: #333;
}
.org-whitespace-newline {
  color: #d3d3d3;
}
.org-whitespace-space {
  color: #d3d3d3;
  background-color: #ffffe0;
}
.org-whitespace-space-after-tab {
  color: #b22222;
  background-color: #ff0;
}
.org-whitespace-space-before-tab {
  color: #b22222;
  background-color: #ff8c00;
}
.org-whitespace-tab {
  color: #d3d3d3;
  background-color: beige;
}
.org-whitespace-trailing {
  color: #ff0;
  background-color: red;
  font-weight: 700;
}
.org-widget-button {
  font-weight: 700;
}
.org-widget-button-pressed {
  color: red;
}
.org-widget-documentation {
  color: #006400;
}
.org-widget-field {
  background-color: #d9d9d9;
}
.org-widget-inactive {
  color: #7f7f7f;
}
.org-widget-single-line-field {
  background-color: #d9d9d9;
}
.org-window-divider {
  color: #999;
}
.org-window-divider-first-pixel {
  color: #ccc;
}
.org-window-divider-last-pixel {
  color: #666;
}
a {
  color: inherit;
  background-color: inherit;
  font: inherit;
  text-decoration: inherit;
}
a:hover {
  text-decoration: underline;
}
body {
  width: 95%;
  margin: 2% auto;
  font-size: 14px;
  line-height: 1.4em;
  font-family: Georgia, serif;
  color: #333;
}
@media screen and (min-width: 600px) {
  body {
    font-size: 18px;
  }
}
@media screen and (min-width: 910px) {
  body {
    width: 900px;
  }
}
::-moz-selection {
  background: #d6edff;
}
::selection {
  background: #d6edff;
}
p {
  margin: 1em auto;
}
dl,
ol,
ul {
  margin: 0 auto;
}
.title {
  margin: 0.8em auto;
  color: #000;
}
.subtitle,
.title {
  text-align: center;
}
.subtitle {
  font-size: 1.1em;
  line-height: 1.4;
  font-weight: 700;
  margin: 1em auto;
}
.abstract {
  margin: auto;
  width: 80%;
  font-style: italic;
}
.abstract p:last-of-type:before {
  content: "    ";
  white-space: pre;
}
.status {
  font-size: 90%;
  margin: 2em auto;
}
[class^="section-number-"] {
  margin-right: 0.5em;
}
[id^="orgheadline"] {
  clear: both;
}
#footnotes {
  font-size: 90%;
}
.footpara {
  display: inline;
  margin: 0.2em auto;
}
.footdef {
  margin-bottom: 1em;
}
.footdef sup {
  padding-right: 0.5em;
}
a {
  color: #527d9a;
  text-decoration: none;
}
a:hover {
  color: #035;
  border-bottom: 1px dotted;
}
figure {
  padding: 0;
  margin: 1em auto;
  text-align: center;
}
img {
  max-width: 100%;
  vertical-align: middle;
}
.MathJax_Display {
  margin: 0 !important;
  width: 90% !important;
}
h1,
h2,
h3,
h4,
h5,
h6 {
  color: #a5573e;
  line-height: 1em;
  font-family: Helvetica, sans-serif;
}
h1,
h2,
h3 {
  line-height: 1.4em;
}
h4,
h5,
h6 {
  font-size: 1em;
}
@media screen and (min-width: 600px) {
  h1 {
    font-size: 2em;
  }
  h2 {
    font-size: 1.5em;
  }
  h3 {
    font-size: 1.3em;
  }
  h1,
  h2,
  h3 {
    line-height: 1.4em;
  }
  h4,
  h5,
  h6 {
    font-size: 1.1em;
  }
}
dt {
  font-weight: 700;
}
table {
  margin: 1em auto;
  border-top: 2px solid;
  border-collapse: collapse;
}
table,
thead {
  border-bottom: 2px solid;
}
table td + td,
table th + th {
  border-left: 1px solid grey;
}
table tr {
  border-top: 1px solid #d3d3d3;
}
td,
th {
  padding: 0.3em 0.6em;
  vertical-align: middle;
}
caption.t-above {
  caption-side: top;
}
caption.t-bottom {
  caption-side: bottom;
}
caption {
  margin-bottom: 0.3em;
}
figcaption {
  margin-top: 0.3em;
}
th.org-center,
th.org-left,
th.org-right {
  text-align: center;
}
td.org-right {
  text-align: right;
}
td.org-left {
  text-align: left;
}
td.org-center {
  text-align: center;
}
blockquote {
  margin: 1em 2em;
  padding-left: 1em;
  border-left: 3px solid #ccc;
}
kbd {
  background-color: #f7f7f7;
  font-size: 80%;
  margin: 0 0.1em;
  padding: 0.1em 0.6em;
}
.todo {
  background-color: red;
}
.done,
.todo {
  color: #fff;
  padding: 0.1em 0.3em;
  border-radius: 3px;
  background-clip: padding-box;
  font-size: 80%;
  font-family: Lucida Console, monospace;
  line-height: 1;
}
.done {
  background-color: green;
}
.priority {
  color: orange;
  font-family: Lucida Console, monospace;
}
#table-of-contents li {
  clear: both;
}
.tag {
  font-family: Lucida Console, monospace;
  font-size: 0.7em;
  font-weight: 400;
}
.tag span {
  padding: 0.3em;
  float: right;
  margin-right: 0.5em;
  border: 1px solid #bbb;
  border-radius: 3px;
  background-clip: padding-box;
  color: #333;
  background-color: #eee;
  line-height: 1;
}
.timestamp {
  color: #bebebe;
  font-size: 90%;
}
.timestamp-kwd {
  color: #5f9ea0;
}
.org-right {
  margin-left: auto;
  margin-right: 0;
  text-align: right;
}
.org-left {
  margin-left: 0;
  margin-right: auto;
  text-align: left;
}
.org-center {
  margin-left: auto;
  margin-right: auto;
  text-align: center;
}
.underline {
  text-decoration: underline;
}
#postamble p,
#preamble p {
  font-size: 90%;
  margin: 0.2em;
}
p.verse {
  margin-left: 3%;
}
:not(pre) > code {
  padding: 2px 5px;
  margin: auto 1px;
  border: 1px solid #ddd;
  border-radius: 3px;
  background-clip: padding-box;
  color: #333;
  font-size: 80%;
}
.org-src-container {
  border: 1px solid #ccc;
  box-shadow: 3px 3px 3px #eee;
  font-family: Lucida Console, monospace;
  font-size: 80%;
  margin: 1em auto;
  padding: 0.1em 0.5em;
  position: relative;
}
.org-src-container > pre {
  overflow: auto;
}
.org-src-container > pre:before {
  display: block;
  position: absolute;
  background-color: #b3b3b3;
  top: 0;
  right: 0;
  padding: 0 0.5em;
  border-bottom-left-radius: 8px;
  border: 0;
  color: #fff;
  font-size: 80%;
}
.org-src-container > pre.src-sh:before {
  content: "sh";
}
.org-src-container > pre.src-bash:before {
  content: "bash";
}
.org-src-container > pre.src-emacs-lisp:before {
  content: "Emacs Lisp";
}
.org-src-container > pre.src-R:before {
  content: "R";
}
.org-src-container > pre.src-cpp:before {
  content: "C++";
}
.org-src-container > pre.src-c:before {
  content: "C";
}
.org-src-container > pre.src-html:before {
  content: "HTML";
}
.org-src-container > pre.src-javascript:before,
.org-src-container > pre.src-js:before {
  content: "Javascript";
}
.org-src-container > pre.src-abc:before {
  content: "ABC";
}
.org-src-container > pre.src-asymptote:before {
  content: "Asymptote";
}
.org-src-container > pre.src-awk:before {
  content: "Awk";
}
.org-src-container > pre.src-C:before {
  content: "C";
}
.org-src-container > pre.src-calc:before {
  content: "Calc";
}
.org-src-container > pre.src-clojure:before {
  content: "Clojure";
}
.org-src-container > pre.src-comint:before {
  content: "comint";
}
.org-src-container > pre.src-css:before {
  content: "CSS";
}
.org-src-container > pre.src-D:before {
  content: "D";
}
.org-src-container > pre.src-ditaa:before {
  content: "Ditaa";
}
.org-src-container > pre.src-dot:before {
  content: "Dot";
}
.org-src-container > pre.src-ebnf:before {
  content: "ebnf";
}
.org-src-container > pre.src-forth:before {
  content: "Forth";
}
.org-src-container > pre.src-F90:before {
  content: "Fortran";
}
.org-src-container > pre.src-gnuplot:before {
  content: "Gnuplot";
}
.org-src-container > pre.src-haskell:before {
  content: "Haskell";
}
.org-src-container > pre.src-io:before {
  content: "Io";
}
.org-src-container > pre.src-java:before {
  content: "Java";
}
.org-src-container > pre.src-latex:before {
  content: "LaTeX";
}
.org-src-container > pre.src-ledger:before {
  content: "Ledger";
}
.org-src-container > pre.src-ly:before {
  content: "Lilypond";
}
.org-src-container > pre.src-lisp:before {
  content: "Lisp";
}
.org-src-container > pre.src-makefile:before {
  content: "Make";
}
.org-src-container > pre.src-matlab:before {
  content: "Matlab";
}
.org-src-container > pre.src-max:before {
  content: "Maxima";
}
.org-src-container > pre.src-mscgen:before {
  content: "Mscgen";
}
.org-src-container > pre.src-Caml:before {
  content: "Objective";
}
.org-src-container > pre.src-octave:before {
  content: "Octave";
}
.org-src-container > pre.src-org:before {
  content: "Org";
}
.org-src-container > pre.src-perl:before {
  content: "Perl";
}
.org-src-container > pre.src-picolisp:before {
  content: "Picolisp";
}
.org-src-container > pre.src-plantuml:before {
  content: "PlantUML";
}
.org-src-container > pre.src-python:before {
  content: "Python";
}
.org-src-container > pre.src-ruby:before {
  content: "Ruby";
}
.org-src-container > pre.src-sass:before {
  content: "Sass";
}
.org-src-container > pre.src-scala:before {
  content: "Scala";
}
.org-src-container > pre.src-scheme:before {
  content: "Scheme";
}
.org-src-container > pre.src-screen:before {
  content: "Screen";
}
.org-src-container > pre.src-sed:before {
  content: "Sed";
}
.org-src-container > pre.src-shell:before {
  content: "shell";
}
.org-src-container > pre.src-shen:before {
  content: "Shen";
}
.org-src-container > pre.src-sql:before {
  content: "SQL";
}
.org-src-container > pre.src-sqlite:before {
  content: "SQLite";
}
.org-src-container > pre.src-stan:before {
  content: "Stan";
}
.org-src-container > pre.src-vala:before {
  content: "Vala";
}
.org-src-container > pre.src-axiom:before {
  content: "Axiom";
}
.org-src-container > pre.src-browser:before {
  content: "HTML";
}
.org-src-container > pre.src-cypher:before {
  content: "Neo4j";
}
.org-src-container > pre.src-elixir:before {
  content: "Elixir";
}
.org-src-container > pre.src-request:before {
  content: "http";
}
.org-src-container > pre.src-ipython:before {
  content: "iPython";
}
.org-src-container > pre.src-kotlin:before {
  content: "Kotlin";
}
.org-src-container > pre.src-Flavored Erlang lfe:before {
  content: "Lisp";
}
.org-src-container > pre.src-mongo:before {
  content: "MongoDB";
}
.org-src-container > pre.src-prolog:before {
  content: "Prolog";
}
.org-src-container > pre.src-rec:before {
  content: "rec";
}
.org-src-container > pre.src-ML sml:before {
  content: "Standard";
}
.org-src-container > pre.src-Translate translate:before {
  content: "Google";
}
.org-src-container > pre.src-typescript:before {
  content: "Typescript";
}
.org-src-container > pre.src-rust:before {
  content: "Rust";
}
.inlinetask {
  background: #ffc;
  border: 2px solid grey;
  margin: 10px;
  padding: 10px;
}
#org-div-home-and-up {
  font-size: 70%;
  text-align: right;
  white-space: nowrap;
}
.linenr {
  font-size: 90%;
}
.code-highlighted {
  background-color: #ff0;
}
#bibliography {
  font-size: 90%;
}
#bibliography table {
  width: 100%;
}
.creator {
  display: block;
}
@media screen and (min-width: 600px) {
  .creator {
    display: inline;
    float: right;
  }
}
.button {
  position: relative;
  display: inline-block;
  vertical-align: top;
  box-sizing: border-box;

  cursor: pointer;
  border-radius: 3px;
  padding: 3px 6px;

  font-family: Arial, Helvetica, sans-serif;
  font-weight: bold;
  font-size: 11px;
  color: #fff;
  text-decoration: none;
}


.github-button {
  background-color: #24292f;
}

.github-button:hover {
  background-color: #57606a;
}

.github-button:active {
  background-color: #6e7781;
}

.telegram-button {
  background-color: #0088cc;
}

.telegram-button:hover {
  background-color: #007dbb;
}

.telegram-button:active {
  background-color: #026698;
}

.button i {
  display: inline-block;
  height: 12px;
  width: 14px;
  vertical-align: middle;
  margin-right: 2px;

  background-size: contain;
}

.button:hover {
  color: #fff;
  border-bottom: 0px;
}

.button svg {
  display: inline-block;
  height: 12px;
  width: 14px;
  vertical-align: middle;
  margin-right: 2px;

}

.telegram-button i {
  background: url("https://telegram.org/img/oauth/tg_button_small.png") no-repeat;
}

.telegram-button span {
  display: inline-block;
  vertical-align: top;
}
</style>
</head>
<body>
<div id="preamble" class="status">
<p class="date">Дата публикации: 19-07-2022</p>
</div>
<div id="content" class="content">
<h1 class="title">The Elm Architecture в Android проекте: 3 года спустя</h1>

<div id="org1cefcba" class="figure">
<p><img src="https://mishkun.xyz/attachments/elmrevisited4.jpg" alt="elmrevisited4.jpg" />
</p>
</div>

<div class="abstract" id="org2567bda">
<p>
Почти 3 года назад я &ldquo;продал&rdquo; TEA своей команде в Авто.ру. С тех пор наша команда
написала 180 TEA-компонентов - от простых экранов с парой кнопок до сложных
форм-визардов с кучей логики. Тогда одним из ключевых требований дизайна,
которые я перед собой ставил, был интероп с тогдашним стеком приложения - MVP +
Clean Architecture, RxJava, Dagger 2. С тех пор я много думал о том, как бы
выглядела архитектура, если убрать ограничение на совместимость с наследием
эпохи Clean Architecture. Эта статья - компиляция моих заметок на эту тему.
</p>

</div>

<div id="outline-container-orgec57d7b" class="outline-2">
<h2 id="orgec57d7b">Какие проблемы я пытался решить при помощи TEA в 2018</h2>
<div class="outline-text-2" id="text-orgec57d7b">
<p>
Любое архитектурное решение должно подкрепляться проблемами, которое оно
призвано решить, а не только хотелкой создателя. Некоторые из проблем специфичны для
Авто.ру, некоторые характерны в целом для Android разработки эпохи CleanArch. Я
рассказывал об общих проблемах в <a href="https://www.youtube.com/watch?v=FPbUAgyMPAc&amp;t=501s">нескольких</a> <a href="https://www.youtube.com/watch?v=5DWuNTVFaXM&amp;t=2735s">докладах</a>. Давайте я в этом
разделе расскажу про более специфичные для Авто.ру. Для меня в дизайне новой
архитектуры были помимо прочих такие проблемы:
</p>
</div>
<div id="outline-container-org8991255" class="outline-3">
<h3 id="org8991255">Наличие готовой логики в виде интеракторов, репозиториев и прочего Clean</h3>
<div class="outline-text-3" id="text-org8991255">
<p>
Когда не пишешь приложение с нуля, а мигрируешь уже существующее, у тебя связаны
руки. Тебе нужно иметь возможность взаимодействовать с любым старым кодом, как
бы странно он не был написан. Поэтому решение должно было быть максимально
абстрактным и легко расширяемым.
</p>
</div>
<div id="outline-container-orga6835f5" class="outline-4">
<h4 id="orga6835f5">Решение в Puerh</h4>
<div class="outline-text-4" id="text-orga6835f5">
<p>
Effect-ы в Puerh - это просто data class с параметрами для
выполнения задачи, но никак не <code>suspend CoroutineScope.(dispatch: Dispatch&lt;Msg&gt;)
-&gt; Any?</code>, как можно увидеть, например, в фреймворке <a href="https://oolong-kt.org/guide/side-effects/">oolong</a>. Это позволяет
отделить обьявление эффекта от его реализации. И за цену горки бойлерплейта
поддержать любую фантазию автора. Такая интерпретация, кстати, убрала надобность
в такой сущности как <a href="https://guide.elm-lang.org/effects/time.html">Sub</a>. Это, как оказалось, легко выражается через
EffectHandler без эффектов. Хоть и многословное, но мне это решение кажется
удачным. Оно позволило развивать архитектуру без лишнего переписывания компонентов.
</p>
</div>
</div>
</div>
<div id="outline-container-org16b5c6f" class="outline-3">
<h3 id="org16b5c6f">Устаревшая ещё тогда RxJava 1</h3>
<div class="outline-text-3" id="text-org16b5c6f">
<p>
Ещё в марте 2018 RxJava 1 достигла последнего релиза. Создатели фреймворка не
собирались далее её поддерживать. Но RxJava была на всех слоях. Типичное
приложение того времени состояло из реактивных обёрток над БД и ретрофитом, реактивных
обёрток над Вьюхами и заставки Windows XP &ldquo;Водопровод&rdquo; из реактивных операторов
между ними.
</p>


<div id="org1f914a9" class="figure">
<p><img src="https://mishkun.xyz/attachments/elmrevisited3.jpg" alt="elmrevisited3.jpg" />
</p>
</div>

<p>
Мигрировать такое большое приложение, как Авто.ру, на другую версию Rx - очень
не простая задача, на которую не хватало технического бюджета.
</p>
</div>
<div id="outline-container-org0776ce0" class="outline-4">
<h4 id="org0776ce0">Решение в Puerh</h4>
<div class="outline-text-4" id="text-org0776ce0">
<p>
Примитивный дизайн EffectHandler, намеренное избегание изобилующих тогда
Rx-интерфейсов, ставших позднее модными корутин и их саспендов - всё это был
задел на &ldquo;Великий Переезд&rdquo;.  Но, как оказалось, тут случился оверкилл. Когда
пишешь TEA для тебя становится совсем не важен фреймворк асинхронщины. Благодаря
тому что все эффекты максимально тупы, ты можешь их писать хоть на джавовых
экзекьюторах. У тебя не будет никакой сложной логики, где ты можешь отстрелить
себе ногу.
</p>
</div>
</div>
</div>
<div id="outline-container-orgbc1a5ec" class="outline-3">
<h3 id="orgbc1a5ec">Скудность опыта решения таких масштабных задач</h3>
<div class="outline-text-3" id="text-orgbc1a5ec">

<div id="org87e6682" class="figure">
<p><img src="https://mishkun.xyz/attachments/elmrevisited1.jpg" alt="elmrevisited1.jpg" />
</p>
</div>

<p>
Хотя мне и доверили внедрение новой архитектуры, признаюсь, опыта решения
подобных задач было немного. Я толком не знал, как лучше провязать DI, как быть
с сохранением стейта. Ну а самое главное - я не мог предугадать направление
технического развития проекта. Да, я думал, что мы когда-то будем вынуждены
отказаться от RxJava 1, ну или что в Android команде когда-нибудь сделают свой
аналог React и заложил эти риски. Но я не мог предсказать, какие технические
проблемы будут стоять перед проектом в будущем
</p>
</div>
<div id="outline-container-orgfef5e80" class="outline-4">
<h4 id="orgfef5e80">Решение в Puerh</h4>
<div class="outline-text-4" id="text-orgfef5e80">
<p>
Я откладывал любое решение &ldquo;до последнего&rdquo;. Старался оперировать максимально
общими интерфейсами, а иногда даже и просто конвенциями. А реализацию давал на откуп
своим коллегам и надеялся на их фидбек. Это привело к нескольким проблемам. Так,
например, аналог действия оператора distinct возник как сторонее расширение
одного из наших разработчиков. А из-за того что я никак не мог определиться с
тред-сейфети методов у коллег возникали проблемы.
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org55eb6c8" class="outline-2">
<h2 id="org55eb6c8">Проблемы Puerh</h2>
<div class="outline-text-2" id="text-org55eb6c8">
<p>
У <a href="https://github.com/Mishkun/Puerh">Puerh</a> есть некоторые концептуальные проблемы как раз произрастающие из того,
что на эту архитектуру надо было мигрировать большой проект. Я всё ещё считаю
Puerh хорошим решением своей задачи. Но если бы я в 2022 году поставил перед
собой цель адаптировать TEA под свежий проект на Android, я бы попробовал
сделать немного иначе.
</p>
</div>
<div id="outline-container-org94123af" class="outline-3">
<h3 id="org94123af">Раздробленность источников правды в Android</h3>
<div class="outline-text-3" id="text-org94123af">
<p>
TEA, как и любая другая UDF архитектура, очень хочет знать всё про всех и
владеть т.н. источником правды - неделимой истиной, постулатом, из которого
выводится всё остальное состояние системы, как из пачки аксиом можно вывести всё
геометрию. И это хорошо соотносится с веб-приложениями, для которых дизайнилось всё
семейство UDF - MVI, Redux, TEA, &lt;ваш arch-name&gt;. Но как бы мы не желали унести
всю логику на бекенд, от Android приложения ожидается, что оно при отсутствии
интернета не превращается в тыкву. А ещё, что открыв его через 10 минут ты
останешься на том же экране с тем же введённым запросом и состоянием. Это
значит, что часть стейта нужно хранить не в памяти приложения, a на диске. В
Puerh предполагалось что часть стейта будет отправляться эффектом
для сохранения на диск, но это раздрабливает стейт и заставляет вас его
синхронизировать. Это сложно и этим редко когда есть время заморачиваться.
</p>
</div>
<div id="outline-container-org82a8f43" class="outline-4">
<h4 id="org82a8f43">Ещё однин пример - сторонние SDK</h4>
<div class="outline-text-4" id="text-org82a8f43">
<p>
Когда работаешь с картой, SDK распознавания чего-то или любым другим сложным UI,
тебе опять приходится синхронизировать свою копию стейта с оригиналом. Это
довольно накладно и заставляет писать много кода, который просто заботится о
том, чтобы у тебя всегда была актуальное состояние для твоей бизнес-логики.
</p>
</div>
</div>
</div>
<div id="outline-container-org30baafc" class="outline-3">
<h3 id="org30baafc">Отсутствие решения для коэффектов</h3>
<div class="outline-text-3" id="text-org30baafc">
<p>
Я ранее <a href="https://mishkun.xyz/blog/Coeffects.html">писал</a> о коэффектах - ситуациях, когда, в отличие от эффектов, нужно
что-то получить из &ldquo;грязного внешнего мира&rdquo;, нежели что-то туда записать.
Например, текущую дату для блокировки кнопки распродажи вовремя или случайное
число для запроса. В каком-то смысле это всё тоже кусочки &ldquo;источника правды&rdquo;. Но
моя реализация предполагала что эта &ldquo;правда&rdquo; придёт в <code>Msg</code> либо вообще минует
бизнес-логику и будет добавлена на стороне эффекта. Несмотря на то, что
ситуация довольно редкая, тем не менее хотелось бы иметь для неё консистентное
решение и не полагаться ad hoc. Тем более что она перекликается с проблемой выше.
</p>
</div>
</div>
<div id="outline-container-org0fcdeaa" class="outline-3">
<h3 id="org0fcdeaa">Сложность state-based навигации</h3>
<div class="outline-text-3" id="text-org0fcdeaa">
<p>
Когда работаешь с TEA, хочется иметь навигацию в виде стейта. Чтобы ты мог
посмотреть в стейт любого из предыдущих экранов, подвигать его, как тебе удобно.
Я писал такой стейт для частных случаев многоэкранных юзерстори, но сделать
обобщенный навигационный фреймворк на основе стейта, интегрируемый с TEA -
слишком сложная задача для меня. Тем более, что есть множество решений от
коммьюнити, которые хотелось бы переиспользовать, а не выкидывать их из проекта
чтобы втащить TEA.
</p>
</div>
</div>
<div id="outline-container-orgb7f5a32" class="outline-3">
<h3 id="orgb7f5a32">Декомпозиция</h3>
<div class="outline-text-3" id="text-orgb7f5a32">
<p>
Когда я хочу выделить какую-то общую логику с мессаджами, эффектами и логикой
вокруг них - я могу завести &ldquo;фичу-донора&rdquo;. Это будет фича, единственное
предназначение которой - быть донором логики для других фичей. Из-за того, что
я могу заглянуть внутрь стейта фичи-донора, потрогать её эффекты, я могу
очень эффективно &ldquo;допиливать напильником&rdquo; фичи-доноры под свои нужды. И это
очень круто работает, когда это необходимо. Когда же я хочу не вдаваться в
подробности, чтобы фича-донор просто &ldquo;делала своё дело&rdquo; - это мешает, потому что
мне всё равно надо заплатить цену необходимого бойлерплейта за это. Особенно эта
цена становится ощутимой, когда пытаешься сделать всё приложение на едином
стейте. Обычно экраны на одном уровне навигации между собой слабо связаны, но
должны быть донорами для фичи верхнего уровня.
</p>
</div>
</div>
</div>
<div id="outline-container-orgec13daf" class="outline-2">
<h2 id="orgec13daf">Общая проблема - в Android разработке не бывает единого источника правды</h2>
<div class="outline-text-2" id="text-orgec13daf">
<p>
У всех перечисленных проблем легко определить общего виновника - конфликт между
желанием TEA иметь единый источник правды и жестокой реальностью, где нет
единства, а есть различные компоненты из которых состоит приложение, каждый из
которых старается не вылезать за границы своей ответственности.
</p>
</div>
<div id="outline-container-org2e2982c" class="outline-3">
<h3 id="org2e2982c">Иерархичная структура</h3>
<div class="outline-text-3" id="text-org2e2982c">
<p>
В Puerh нам навязывается иерархичная структура приложения. Это не совсем плохо,
ведь есть трейд-офф между жесткой иерархичностью и динамизмом плоской структуры.
В иерархии всегда можно найти проблему, спускаясь по дереву сверху вниз. В такой
структуре сложнее пропустить <code>Msg</code> или забыть обработать <code>Effect</code>. Однако это
всё обрастает бюрократией в виде бесконечных wrapping-ов для передачи данных
вверх-вниз, пока не добредёшь до настоящей бизнес-логики.
</p>
</div>
</div>
<div id="outline-container-org125aa58" class="outline-3">
<h3 id="org125aa58">Плоская структура</h3>
<div class="outline-text-3" id="text-org125aa58">
<p>
В Puerh мы в команде долго обсуждали, стоит ли делать EffectHandler иерархичным,
где верхнеуровневый <code>EffectHandler</code> определяет, как эффекты передать его
&ldquo;подчинённым&rdquo; или же плоским, где каждому <code>EffectHandler</code> выдаётся все <code>Effect</code>,
а он лишь отбирает нужные. С одной стороны, в иерархичном подходе мы
гарантированно обрабатываем все <code>Effects</code>, благодаря exhaustive matching. С
другой стороны, плоский подход позволяет писать меньше кода и даёт больше
гибкости. Мы остановились на плоском подходе и мне кажется, что это решение
позволило больше сэкономить кода, чем бы нанёс пользы exhaustive matching. Ведь
проблемы, которые в теории решал иерархический подход, ни разу не всплыли в продакшне.
</p>
</div>
</div>
<div id="outline-container-orgd9d693d" class="outline-3">
<h3 id="orgd9d693d">Тезис - Android приложения по своей природе более плоские</h3>
<div class="outline-text-3" id="text-orgd9d693d">
<p>
Хорошей практикой в мире Android приложений сейчас считается выделять
компоненты, которые закрывают собой целиком юзер-стори. Как правило, такие
компоненты выстраиваются в довольно плоскую структуру; единственными
зависимостями между ними выступают навигационные переходы. Типичный граф экранов в
приложении можно поделить на подграфы в 2-5 экранов каждый, которые являются
&ldquo;вещами в себе&rdquo; и требуют минимум внешних зависимостей и внешней координации.
</p>
</div>
</div>
</div>
<div id="outline-container-org1c64c66" class="outline-2">
<h2 id="org1c64c66">Коэффекты спешат на помощь</h2>
<div class="outline-text-2" id="text-org1c64c66">
<p>
То, что в реальности не бывает единого источника правды, а только несколько
разрозненных &ldquo;тематик&rdquo;, в каждой из которых есть единый источник, не должно
отталкивать от использования UDF. Мне по-прежнему важно иметь логику, описанную
чистыми функциями. Мне по-прежнему важно обрабатывать входящие <code>Msg</code> строго
последовательно. Мне по-прежнему важно знать состояние интересующих нас
источников правды. Нужно лишь придумать удобную абстракцию для описания этих
источников независимо друг от друга. Для этого я предлагаю обратиться к
коэффектам.
</p>
</div>
<div id="outline-container-org72e43e4" class="outline-3">
<h3 id="org72e43e4">Кейс 1: Коэффекты как вычисление аргумента извне</h3>
<div class="outline-text-3" id="text-org72e43e4">
<p>
Изначально коэффектами я заинтересовался как возможное решение досадной
проблемы - как получить случайное число для использования в своей логике. Логика
должна быть чистой, поэтому написать <code>getRandom()</code> посреди редьюсера нельзя. В
<a href="https://guide.elm-lang.org/effects/random.html">гайде по TEA</a> предлагается выдавать некий <code>Effect.RandomInt</code> и ловить ответное
сообщение. Но это делает обработку изначального сообщения асинхронным и сильно
усложняет структуру стейта и логики. В похожей архитектуре <a href="https://github.com/pointfreeco/swift-composable-architecture">TCA</a> в редьюсер
передаётся некоторый <code>Environment</code>, который моментально делает редьюсер грязным и
заставляет себя мокать в автотестах. В фреймворке <a href="http://day8.github.io/re-frame/">re-frame</a> же все просто - ты
указываешь некий <code>Coeffect.RandomInt</code> и получаешь случайное число сразу же в
аргументы для своей функции, описывающей логику.
</p>
</div>
</div>
<div id="outline-container-org254575e" class="outline-3">
<h3 id="org254575e">Кейс 2: Стейт внешних SDK тоже можно получать как Coeffect</h3>
<div class="outline-text-3" id="text-org254575e">
<p>
Если ты работаешь с SDK карт или авторизации, тебе не нужно постоянно
синхронизировать состояние точки на карте со своим стейтом. Если описать
<code>Coeffect.GetPoint</code> то я могу опрашивать карту и получать актуальное состояние в
каждый обработчик сообщений, который этого потребует. Точно так же можно иметь
<code>Coeffect.UserState</code> который достаёт текущего юзера для моего обработчика.
</p>
</div>
</div>
<div id="outline-container-orgd2f1ed2" class="outline-3">
<h3 id="orgd2f1ed2">Кейс 3: Стейт своего юзер-стори тоже можно получать как Coeffect</h3>
<div class="outline-text-3" id="text-orgd2f1ed2">
<p>
Если стейт карт и текущего юзера можно получать из коэффектов, то чем &ldquo;наш&rdquo;
стейт лучше/хуже? И как вообще определить, какой стейт &ldquo;наш&rdquo;, а какой уже
&ldquo;общий&rdquo;? Поэтому я предлагаю любой стейт доставать из коэффектов, а записывать
его эффектами. Это позволит также хранить куски стейта по-разному - в памяти или
на диске и полностью скрыть это от нашей бизнес-логики.
</p>
</div>
</div>
<div id="outline-container-org21bf481" class="outline-3">
<h3 id="org21bf481">Кейс 4: Стейт фичи-донора тоже можно получать как Coeffect</h3>
<div class="outline-text-3" id="text-org21bf481">
<p>
Теперь, если тебя не интересует стейт фичи-донора, ты можешь ничего не указывать
в коэффектах. Но если тебе нужно, то можно указать довольно точно, что конкретно
требуется достать. Ведь теперь стейт не обязан лежать монолитом, а следовательно
может быть разделён на приватный и публичный и доставаться разными коэффектами.
</p>
</div>
</div>
</div>
<div id="outline-container-org1279ab6" class="outline-2">
<h2 id="org1279ab6">Что получается на практике?</h2>
<div class="outline-text-2" id="text-org1279ab6">

<div id="org7c80ace" class="figure">
<p><img src="https://mishkun.xyz/attachments/elmrevisited2.jpg" alt="elmrevisited2.jpg" />
</p>
</div>

<p>
Детали этой архитектуры я ещё прорабатываю на семпловом приложении. Поэтому
дисклеймер сразу - ссылки на гитхаб, где можно посмотреть всё, нет. Но некоторые
наброски есть. Сразу извиняюсь за код с корутинами, я всё ещё учусь его
правильно писать.
</p>
</div>
<div id="outline-container-org1b358b0" class="outline-3">
<h3 id="org1b358b0">Основные части</h3>
<div class="outline-text-3" id="text-org1b358b0">
<p>
В целом архитектура будет состоять из пяти необходимых компонентов
</p>
<ul class="org-ul">
<li><code>MessageHandler</code> (aka reducer) с чистой бизнес-логикой</li>
<li><code>CoeffectHandler</code> с обработкой коэффектов</li>
<li><code>EffectHandler</code> с обработкой эффектов</li>
<li><code>Selector</code> с подпиской на стейт</li>
<li><code>Engine</code> который будет связывать всё выше и следить за очередью сообщений</li>
</ul>
<p>
Получается такой классический паттерн <a href="https://blog.ploeh.dk/2020/03/02/impureim-sandwich/">Impureim Sandwich</a>, где у меня сначала есть
получение входных данных из грязного внешнего мира, чистая обработка нашей
бизнес-логикой в середине и применение изменений к грязному внешнему миру в
конце.
</p>
</div>
</div>
<div id="outline-container-org18d01c7" class="outline-3">
<h3 id="org18d01c7">MessageHandler</h3>
<div class="outline-text-3" id="text-org18d01c7">
<p>
Классическая сигнатура <code>Msg, State -&gt; State, Set&lt;Effect&gt;</code> упрощается до <code>Msg,
Coeffects -&gt; Set&lt;Effect&gt;</code>. Теперь стейт &ldquo;такой же как все&rdquo; и теряется в толпе
эффектов и коэффектов. Однако мне теперь нужна ещё одна функция, выполняющая
&ldquo;заказ&rdquo; нужных коэффектов - заведём и её: <code>Msg -&gt; Coeffects</code>. Таким образом, вся
бизнес-логика укладывается в две функции.
</p>
<div class="org-src-container">
<pre class="src src-kotlin"><span style="color: #e45649;">class</span> <span style="color: #986801;">MsgHandler</span>(
    <span style="color: #e45649;">val</span> <span style="color: #6a1868;">coeffect</span>: (<span style="color: #986801;">Message</span>) -&gt; <span style="color: #986801;">Coeffects</span>,
    <span style="color: #e45649;">val</span> <span style="color: #6a1868;">update</span>: (<span style="color: #986801;">Message</span>, <span style="color: #986801;">Coeffects</span>) -&gt; <span style="color: #986801;">Set&lt;Effect&lt;Message&gt;&gt;</span>
)
</pre>
</div>
</div>
<div id="outline-container-orgbb5157c" class="outline-4">
<h4 id="orgbb5157c">Как представлять Coeffects</h4>
<div class="outline-text-4" id="text-orgbb5157c">
<p>
При достаточной внимательности ты можешь хмыкнуть &ldquo;что же это за <code>Coeffects</code>
такие?&rdquo;. И будешь прав. Реализация <code>Coeffects</code> это краеугольный камень, который
важно сделать правильно. Я вдохновлялся <code>re-frame</code> и не нашёл способа лучше чем
сделать коэффекты гетерогенной мапой. Ты наверняка мог встречать подобную
структуру данных, если смотрел как устроен <code>CoroutineContext</code>. Если кратко, то
это мапа, где хранятся разные типы данных. А какой тип у значения - определяется
ключом. Я решил не пользоваться какой-то <a href="https://github.com/broo2s/typedmap">специальной реализацией</a>, а просто
сделать тайпалиас к обычной мапе и парочку утилитных функций.
</p>
<div class="org-src-container">
<pre class="src src-kotlin"><span style="color: #e45649;">interface</span> <span style="color: #986801;">Coeffect&lt;out</span> <span style="color: #986801;">RESULT&gt;</span>
<span style="color: #e45649;">typealias</span> <span style="color: #986801;">CoeffectMap&lt;T&gt;</span> = <span style="color: #986801;">Map&lt;Coeffect&lt;T&gt;</span>, <span style="color: #986801;">T&gt;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org5da6342" class="outline-4">
<h4 id="org5da6342">Синтаксический сахар для корректности</h4>
<div class="outline-text-4" id="text-org5da6342">
<p>
Если присмотреться к двум функциям, которые определяют <code>MessageHandler</code>, то
кажется, что мы теряем type-safety.
</p>
<div class="org-src-container">
<pre class="src src-kotlin"><span style="color: #e45649;">class</span> <span style="color: #986801;">MsgHandler</span>(
    <span style="color: #e45649;">val</span> <span style="color: #6a1868;">coeffect</span>: (<span style="color: #986801;">Message</span>) -&gt; <span style="color: #986801;">CoeffectMap&lt;*&gt;</span>,
    <span style="color: #e45649;">val</span> <span style="color: #6a1868;">update</span>: (<span style="color: #986801;">Message</span>, <span style="color: #986801;">CoeffectMap&lt;*&gt;</span>) -&gt; <span style="color: #986801;">Set&lt;Effect&lt;Message&gt;&gt;</span>
)
</pre>
</div>
<p>
И если для <code>re-frame</code> и Clojure это ок, то в Kotlin мы хотим
статической типизации. Тут на помощь приходит то, что <code>MsgHandler</code> нужно
определять сразу весь в одном месте и мы можем замазать динамическую типизацию
сахарным сиропом. Например, если нам нужен только один коэффект, мы можем
написать такой factory method:
</p>
<div class="org-src-container">
<pre class="src src-kotlin"><span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">utils.kt</span>
<span style="color: #e45649;">inline</span> <span style="color: #e45649;">fun</span> &lt;<span style="color: #e45649;">reified</span> <span style="color: #986801;">CORESULT</span> : <span style="color: #986801;">Any&gt;</span> messageHandler(
    coeffect: <span style="color: #986801;">Coeffect&lt;CORESULT&gt;</span>,
    <span style="color: #e45649;">noinline</span> update: (<span style="color: #986801;">Message</span>, <span style="color: #986801;">CORESULT</span>) -&gt; <span style="color: #986801;">Set&lt;Effect&lt;Message&gt;&gt;</span>
): <span style="color: #986801;">MsgHandler</span> = <span style="color: #986801;">MsgHandler</span>(
    coeffect = { coeffectMapOf(coeffect) },
    update = { msg, coeffectMap -&gt; update(msg, coeffectMap.safeGet&lt;<span style="color: #986801;">CORESULT&gt;</span>()) }
)

<span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">logic.kt</span>
<span style="color: #e45649;">val</span> <span style="color: #6a1868;">messageHandler</span> = messageHandler(<span style="color: #986801;">MyFeature.Coeffects.GetState</span>) { msg: <span style="color: #986801;">Msg</span>, state: <span style="color: #986801;">MyFeatureState</span> -&gt;
    <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">logic</span>
}
</pre>
</div>
<p>
Похожим образом мы можем опрелить factory method для любого числа коэффектов. И
всё будет достаточно типобезопасно. Если, конечно, не забыть обработать все
коэффекты.
</p>
</div>
</div>
</div>
<div id="outline-container-orgb800224" class="outline-3">
<h3 id="orgb800224">EffectHandler</h3>
<div class="outline-text-3" id="text-orgb800224">
<p>
<code>EffectHandler</code> в Puerh был достаточно хорош. Я бы и не вносил в него изменения,
но всё равно есть несколько идей, как его можно улучшить. Я хочу добавить в него
suspend-функции, потому что мне кажется что корутины в Android разработке
надолго - нам-то точно в обозримом будущем не завезут Loom. У меня существуют
некоторые предубеждения насчёт использования <code>Flow</code> в интерфейсе хендлера,
хочется использовать более низкоуровневое API. Практика показывает, что этот
приём отбивает желание пихать логику в <code>EffectHandler</code>. Да и концептуально
хендлеры нифига не холодные потоки, а ближе к акторам. Пока что кажется, что
интерфейс <code>EffectHandler</code> может выглядеть как-то так.
</p>
<div class="org-src-container">
<pre class="src src-kotlin"><span style="color: #e45649;">abstract</span> <span style="color: #e45649;">class</span> <span style="color: #986801;">EffectHandler</span>(
    <span style="color: #e45649;">private</span> <span style="color: #e45649;">val</span> <span style="color: #6a1868;">continuation</span>: <span style="color: #e45649;">suspend</span> <span style="color: #e45649;">fun</span> (<span style="color: #986801;">Effect</span>) -&gt; <span style="color: #986801;">Unit</span>
) {
    <span style="color: #e45649;">abstract</span> <span style="color: #e45649;">suspend</span> <span style="color: #e45649;">fun</span> <span style="color: #a626a4;">handleEffect</span>(effects: <span style="color: #986801;">Set&lt;Effect&lt;*&gt;&gt;</span>)
}
</pre>
</div>
<p>
Ещё одно отличие в данном случае - хендлер принимает все эффекты сразу вместо
того чтобы обрабатывать их по отдельности. Это сделано для того чтобы удобнее
было работать с эффектами изменения стейта и обрабатывать их синхронно и
транзакционно.
</p>
</div>
<div id="outline-container-org35467cc" class="outline-4">
<h4 id="org35467cc">EffectHandler как Middleware</h4>
<div class="outline-text-4" id="text-org35467cc">
<p>
По сравнению с Puerh хотелось улучшить эргономику эффектов. Если мы делаем всё
приложение на эффектах, нам неизбежно захочется выделить низкоуровневые эффекты
типа <code>HttpGet</code> или <code>SaveState</code> и хендлеры для них.  Для поддержки этого я
заменил <code>listener: (Message) -&gt; Unit</code> коллбеком <code>continuation</code>.  Теперь
<code>EffectHandler</code> может делегировать исполнение другим хендлерам, и при желании
собирать целые саги как в <a href="https://redux-saga.js.org/">redux-saga</a>, когда мы будем ожидать нового эффекта для
продолжения работы. Ну а отправка сообщений будет осуществляться специальным
эффектом <code>Dispatch(Message)</code>. Возможно, вместо suspend функции здесь лучше бы
смотрелся <code>SendChannel&lt;Effect&gt;</code>, но я не уверен, что хочу давать возможность
хендлерам закрывать канал.
</p>
</div>
</div>
</div>
<div id="outline-container-org960359d" class="outline-3">
<h3 id="org960359d">CoeffectHandler</h3>
<div class="outline-text-3" id="text-org960359d">
<p>
<code>CoeffectHandler</code> мог бы вообще отсутствовать, если принять коэффекты подвидом
эффектов и переиспользовать сущность <code>EffectHandler</code> для них. Но для
коэффектов существует контракт что они должны быть синхронными, ведь обработка
сообщений должна быть последовательной. Поэтому обрастание саспендами тут не
играет на руку.
</p>
<div class="org-src-container">
<pre class="src src-kotlin"><span style="color: #e45649;">interface</span> <span style="color: #986801;">CoeffectHandler</span> {
    <span style="color: #e45649;">fun</span> <span style="color: #a626a4;">handleCoeffect</span>(coeffects: <span style="color: #986801;">CoeffectMap&lt;*&gt;</span>): <span style="color: #986801;">CoeffectMap&lt;*&gt;</span>
}
</pre>
</div>
<p>
Контракт <code>CoeffectHandler</code> в таком случае гласит, что он пробегается по мапе
коэффектов, находит среди ключей интересующие его, исполняет их и подкладывает
результат в мапу.
</p>
</div>
<div id="outline-container-org787b3b5" class="outline-4">
<h4 id="org787b3b5">Маппинг</h4>
<div class="outline-text-4" id="text-org787b3b5">
<p>
Одну штуку я подсмотрел в <code>re-frame</code>. Там в процессе обработки сообщение
пропускается через стек интерцепторов, которые по своей сути похожи на
интерцепторы в http-библиотеках. Точно так же наша бизнес-логика может
оперировать высокоуровневыми коэффектами типа <code>LoadState(id)</code> или
<code>GetDate</code>, которые можно потом пропустить по стеку мапперов и &ldquo;рассахарить&rdquo; в
низкоуровневые <code>DiskState</code> или <code>GetDateTimeFormatted</code>. Это можно сделать частью
контракта <code>CoeffectHandler</code>. Теперь можно получать <code>CoeffectMap</code> перед выполнением
коэффектов и после. Например, чтобы переложить результат <code>GetDateTimeFormatted</code>
в ячейку коэффекта <code>GetDate</code>, который ожидает <code>MessageHandler</code>
</p>
<div class="org-src-container">
<pre class="src src-kotlin"><span style="color: #e45649;">interface</span> <span style="color: #986801;">CoeffectHandler</span> {
    <span style="color: #e45649;">fun</span> <span style="color: #a626a4;">before</span>(coeffects: <span style="color: #986801;">CoeffectMap&lt;*&gt;</span>): <span style="color: #986801;">CoeffectMap&lt;*&gt;</span>
    <span style="color: #e45649;">fun</span> <span style="color: #a626a4;">after</span>(coeffects: <span style="color: #986801;">CoeffectMap&lt;*&gt;</span>): <span style="color: #986801;">CoeffectMap&lt;*&gt;</span>
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org7d2acfa" class="outline-3">
<h3 id="org7d2acfa">Selector</h3>
<div class="outline-text-3" id="text-org7d2acfa">
<p>
Так как источников правды несколько, нужна будет сущность, которая будет
подписываться на коэффекты, собирать из нескольких источников стейт и отдавать
его в виде <code>ViewState</code> в Compose или другой UI. Интерфейс его должен выглядеть
так:
</p>
<div class="org-src-container">
<pre class="src src-kotlin"><span style="color: #e45649;">interface</span> <span style="color: #986801;">Selector</span>{
    <span style="color: #e45649;">fun</span> <span style="color: #a626a4;">subscriptions</span>(): <span style="color: #986801;">CoeffectMap</span>
    <span style="color: #e45649;">fun</span> <span style="color: #a626a4;">update</span>(coeffects: <span style="color: #986801;">CoeffectMap</span>)
}
</pre>
</div>
<p>
Если присмотреться, то этот интерфейс чем-то дуален <code>MessageHandler</code>. Не знаю,
есть ли выкладки теорката под этот случай.
</p>
</div>
</div>
<div id="outline-container-org84683f9" class="outline-3">
<h3 id="org84683f9">Engine</h3>
<div class="outline-text-3" id="text-org84683f9">
<p>
<code>Engine</code> должен связывать все компоненты воедино.
</p>
<div class="org-src-container">
<pre class="src src-kotlin"><span style="color: #e45649;">interface</span> <span style="color: #986801;">Engine</span> {
    <span style="color: #e45649;">fun</span> <span style="color: #a626a4;">dispatch</span>(message: <span style="color: #986801;">Message</span>)

    <span style="color: #e45649;">fun</span> <span style="color: #9ca0a4;">/*</span><span style="color: #9ca0a4;">un*/</span>registerEffectHandler(effectHandler: <span style="color: #986801;">EffectHandler</span>)
    <span style="color: #e45649;">fun</span> <span style="color: #9ca0a4;">/*</span><span style="color: #9ca0a4;">un*/</span>registerCoeffectHandler(coeffectHandler: <span style="color: #986801;">CoeffectHandler</span>)
    <span style="color: #e45649;">fun</span> <span style="color: #9ca0a4;">/*</span><span style="color: #9ca0a4;">un*/</span>registerMessageHandler(messageHandler: <span style="color: #986801;">MessageHandler</span>)
    <span style="color: #e45649;">fun</span> <span style="color: #9ca0a4;">/*</span><span style="color: #9ca0a4;">un*/</span>registerSelector(selector: <span style="color: #986801;">Selector</span>)

    <span style="color: #e45649;">fun</span> <span style="color: #a626a4;">dispose</span>()
}
</pre>
</div>
</div>
<div id="outline-container-org1083fea" class="outline-4">
<h4 id="org1083fea">DI и навигация</h4>
<div class="outline-text-4" id="text-org1083fea">
<p>
Зачем мне динамическая регистрация компонентов? Меня очень вдохновил
концепт <code>CompositionLocal</code> в compose. Идея о том что в зависимости позиции в
дереве одни и те же мессаджи могут обрабатываться по-разному сулит классное
переиспользование UI-компонентов. Кроме того мне очень нравится <a href="https://arkivanov.github.io/Decompose/">Decompose</a> и я
надеюсь что с ним можно будет интегрировать своё решение, чтобы не
переизобретать навигацию. В моих планах каждый такой decompose-компонент будет
просто регистрировать/дерегистрировать хендлеры в результате навигации и
подписывать Selector на изменения стейта.
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orgc33e1b0" class="outline-2">
<h2 id="orgc33e1b0">Request For Comments</h2>
<div class="outline-text-2" id="text-orgc33e1b0">
<p>
Эта статья лишь компиляция моих размышлений на тему интеграции коэффектов в TEA.
Приблизительный план, как это должно выглядеть. Мне было бы очень интересно
узнать, где этот план хромает и где можно его улучшить. Приходи в канал, находи
этот пост и присоединяйся к обсуждению. Особенно меня интересуют критика новых
<code>EffectHandler</code> и возможные подводные камни реализации <code>Engine</code>.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<a class="telegram-button button" href="https://t.me/izpodshtorki" target="_blank"><i></i><span>Подпишись и обсуждай в Telegram</span></a>
</div>
</body>
</html>
